//
// Created by lxcy on 2025/9/30.
// 用于定义杂项数据与函数的文件
#include "other.h"

//自动生成两个电流滤波函数
//GenerateFunction_MedianFilter3(Ia)
//GenerateFunction_MedianFilter3(Ib)
// 自动生成两个电流的5点中值滤波函数
GenerateFunction_MedianFilter5(Ia)
GenerateFunction_MedianFilter5(Ib)

float IIR_filter(float input,const float a[3],const float b[3],float w[3]) {
    //初始化
    w[0]=w[1];
    w[1]=w[2];
    //求状态变量
    w[2]=a[0]*input-a[1]*w[1]-a[2]*w[0];
    //求输出
    return b[0]*w[2]+b[1]*w[1]+b[2]*w[0];
}

float IIR_filter10A(float input) {
    static float w1[3],w2[3],w3[3],w4[3],w5[3];
    const float A1[3] = {0.182953161850480966466037102691188920289 ,
        -1.043506288836516970874868093233089894056,
        0.77531893623844072571671404148219153285 };
    const float A2[3] = {0.150741958445936297117384583543753251433 ,
        -0.859783892439210717384412419050931930542,
  0.462751726222955850342799521968117915094 };
    const float A3[3] = {0.131106439916625960862006650131661444902 ,
        -0.747789178258503439700177750637521967292,
      0.272214937925007283148204351164167746902};
    const float A4[3] = {0.119771415878955525546878391196514712647 ,
        -0.683137828438767691352495603496208786964,
     0.162223491954589793540009168282267637551};
    const float A5[3] = {0.114564137569474075450948191701172618195  ,
        -0.653437179328878570139238490810384973884,
    0.111693729606774913576394681058445712551};
    const float B[3] = {1.f,2.f,1.f};
    float f1=IIR_filter(input,A1,B,w1);
    float f2=IIR_filter(f1,A2,B,w2);
    float f3=IIR_filter(f2,A3,B,w3);
    float f4=IIR_filter(f3,A4,B,w4);
    float f5=IIR_filter(f4,A5,B,w5);
    return f5;
}

float IIR_filter10B(float input) {
    static float w1[3],w2[3],w3[3],w4[3],w5[3];
    const float A1[3] = {0.182953161850480966466037102691188920289 ,
        -1.043506288836516970874868093233089894056,
        0.77531893623844072571671404148219153285 };
    const float A2[3] = {0.150741958445936297117384583543753251433 ,
        -0.859783892439210717384412419050931930542,
  0.462751726222955850342799521968117915094 };
    const float A3[3] = {0.131106439916625960862006650131661444902 ,
        -0.747789178258503439700177750637521967292,
      0.272214937925007283148204351164167746902};
    const float A4[3] = {0.119771415878955525546878391196514712647 ,
        -0.683137828438767691352495603496208786964,
     0.162223491954589793540009168282267637551};
    const float A5[3] = {0.114564137569474075450948191701172618195  ,
        -0.653437179328878570139238490810384973884,
    0.111693729606774913576394681058445712551};
    const float B[3] = {1.f,2.f,1.f};
    float f1=IIR_filter(input,A1,B,w1);
    float f2=IIR_filter(f1,A2,B,w2);
    float f3=IIR_filter(f2,A3,B,w3);
    float f4=IIR_filter(f3,A4,B,w4);
    float f5=IIR_filter(f4,A5,B,w5);
    return f5;
}

float IIR_filter2A(float input) {
    static float w[3];
    const float A[3] = {0.505001029045877625200944294192595407367,
        0.747789178258503328677875288121867924929,
 0.272214937925007283148204351164167746902 };
    const float B[3] = {1.f,2.f,1.f};
    return IIR_filter(input,A,B,w);
}
float IIR_filter2B(float input) {
    static float w[3];
    const float A[3] = {0.505001029045877625200944294192595407367,
        0.747789178258503328677875288121867924929,
 0.272214937925007283148204351164167746902};
    const float B[3] = {1.f,2.f,1.f};
    return IIR_filter(input,A,B,w);
}